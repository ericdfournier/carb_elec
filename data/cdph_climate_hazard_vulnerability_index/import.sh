#!/usr/bin/env bash
set -ue  # Set nounset and errexit Bash shell attributes.

################################################################################
# Import CARB Priority Populations
#
# Creates tables:
# - cdph.ca_county_climate_hazard_vulnerability_index
# - cdph.ca_tract_climate_hazard_vulnerability_index
#
# Converts SRS to EPSG:3310 (NAD83 / California Albers).
################################################################################

# Set environment parameters
format='PostgreSQL'
dst="postgresql://$PGUSER@$PGHOST/carb"
schema='cdph'
src='/Users/edf/repos/carb_elec/data/cdph_climate_hazard_vulnerability_index/raw/'
out='/Users/edf/repos/carb_elec/data/cdph_climate_hazard_vulnerability_index/'

# Import county level chvi table
file='CHVI_county_data.csv'
table='ca_county_climate_hazard_vulnerability_index'

ogr2ogr -f $format $dst \
    $src$file \
    -lco SCHEMA=$schema \
    -nln $table  \
    -emptyStrAsNull \
    -lco DESCRIPTION=$table \
    --debug ON

# Import tract level chvi table
file='CHVI_tract_data.csv'
table='ca_tract_climate_hazard_vulnerability_index'

ogr2ogr -f $format $dst \
    $src$file \
    -lco SCHEMA=$schema \
    -nln $table  \
    -emptyStrAsNull \
    -lco DESCRIPTION=$table \
    --debug ON

# Write table metadata
table='ca_county_climate_hazard_vulnerability_index'
ogrinfo -so -ro $dst $schema.$table > $out$table'_orginfo.txt'

table='ca_tract_climate_hazard_vulnerability_index'
ogrinfo -so -ro $dst $schema.$table > $out$table'_orginfo.txt'
